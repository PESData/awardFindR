<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Contributing • awardFindR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script>




<meta property="og:title" content="Contributing" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-title-body">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">awardFindR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="articles/awardFindR.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/PESData/awardFindR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>Contributing</h1>
    </div>

<div id="contributing" class="section level1">

<p><code>awardFindR</code> is built to be easily extendable to include additional data sources and we welcome contributions adding support for additional databases of research funding.</p>
<p>Adding a new source involves three steps:</p>
<ol>
<li>Adding a <code>sourcename.R</code> file that parse the database using its API or webscraping as discussed</li>
<li>Adding the source to default <code>sources</code> argument of the <code><a href="reference/awardFindR.html">awardFindR()</a></code> function in <code>main.R</code>
</li>
<li>Adding relevant tests</li>
</ol>
<div id="adding-a-new-source" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-a-new-source" class="anchor"></a>Adding a new source</h2>
<p>New sources are entirely self-contained in a single <code>.R</code> file.</p>
<p>Sources need to have a minimum of two functions:</p>
<ol>
<li>a <code>*_get</code> function that scrapes raw data from the source and returns it as-is,</li>
<li>and a hidden <code>.*_standardize</code> (note the preceding period) function that harmonizes the data to fit the data.frame output from <code>awardFindR</code>.</li>
</ol>
<p>The file containing the source should have an easily identifiable filename, which should be reflected in the naming of the <code>*_get</code> and <code>*_standardize</code> functions. For example, import from the “Megafunds Foundation” should be in <code>megafunds.R</code>, containing <code>megafunds_get()</code> and <code>.megafunds_standardize()</code>.</p>
<div id="_get" class="section level3">
<h3 class="hasAnchor">
<a href="#_get" class="anchor"></a><code>*_get</code>
</h3>
<p>The <code>*_get</code> routine is exported, so end users can call it directly if they have interest in a specific data source. It should be as faithful a reproduction of the original data source as possible, though variables should still be R-friendly (for example, award amounts as strings like “$300,000” aren’t useful. An integer of 300000 is much more useful.)</p>
<p>These routines will usually use HTML or JSON-based HTTP resources. <code>utils.R</code> in this package has a <code>request()</code> function that handles HTTP POST and GET requests with <code>httr</code> and returns xml2 objects (which can be used with <code>rvest</code> or <code>xml2</code>) or json as a base R <code><a href="https://rdrr.io/r/base/list.html">list()</a></code> object automatically. In order to centralize HTTP error handling and standardize message output to the user, please employ this function as much as possible for HTTP requests.</p>
</div>
<div id="style-and-dependencies" class="section level3">
<h3 class="hasAnchor">
<a href="#style-and-dependencies" class="anchor"></a>Style and dependencies</h3>
<p>This function can be largely tailored to the needs of an API, but should follow some basic style guidelines. Three arguments are required:</p>
<ol>
<li>Keyword</li>
<li>From date</li>
<li>To date</li>
</ol>
<p>The function should accept at least one keyword and two date terms as arguments. <em>keyword</em> is a string, or, if the source can handle more than one keyword at a time, <em>keywords</em> is a vector of strings. Dates are typically exact days or years, depending on the capabilities of the search function available from the source. Exact dates should be date objects named <em>from_date</em> and <em>to_date</em>, while years should be integers named <em>from_year</em> and <em>to_year</em>.</p>
<p>Additional source-specific variables can be added to the function, but should have default values specified. <code>*_get</code> routines should function as expected with these three variables alone.</p>
<p>If at all possible, searching should be done server-side to reduce HTTP traffic. Downloading the whole grant database and searching with <code><a href="https://rdrr.io/r/base/grep.html">grep()</a></code> or a similar function should be a last resort. This also minimizes CPU load.</p>
<p>JSON sources shouldn’t need any additional dependencies, since the <code>request()</code> function handles encoding and decoding from/to lists automatically. HTML/XML sources, however, should use <code>rvest</code> or <code>xml2</code>, respectively.</p>
<p>If the source does not use HTML, XML or JSON, it may be necessary to employ additional dependencies as necessary. This is an extreme case and should be done with care.</p>
</div>
<div id="_standardize" class="section level3">
<h3 class="hasAnchor">
<a href="#_standardize" class="anchor"></a><code>.*_standardize</code>
</h3>
<p>The <code>awardFindR</code> calls the internal<code>.*_standardize</code> function, which should in turn call the <code>*_get</code> function described above. All <code>.*_standardize</code> functions need to accept the exact same input. This includes:</p>
<ol>
<li>
<em>keywords</em> - A vector of keywords to search</li>
<li>
<em>from_date</em> - A beginning date object (e.g. “2015-01-01”)</li>
<li>
<em>end_date</em> - And ending date object</li>
</ol>
<p>The date objects should be translated into whatever the source-specific requirements are for search terms. If an API can only delineate searches by year, get the year. If an API can only handle one keyword at a time, loop the function through multiple keywords with <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code>.</p>
<p>This function needs to return a <code>data.frame</code> with the following columns:</p>
<ol>
<li>
<em>institution</em> - Institution name</li>
<li>
<em>pi</em> - Principal investigator name</li>
<li>
<em>year</em> - Award year</li>
<li>
<em>start</em> - Award start date</li>
<li>
<em>end</em> - Award end date</li>
<li>
<em>program</em> - Program or department name</li>
<li>
<em>amount</em> - Award amount (in US dollars)</li>
<li>
<em>id</em> - Award ID number (or any way of uniquely identifying duplicates from one source)</li>
<li>
<em>title</em> - Project title or description</li>
<li>
<em>keyword</em> - The searched keyword that returned this result</li>
<li>
<em>source</em> - The source the result came from</li>
</ol>
</div>
</div>
<div id="including-the-source-in-awardfindr" class="section level2">
<h2 class="hasAnchor">
<a href="#including-the-source-in-awardfindr" class="anchor"></a>Including the Source in <code>awardFindR()</code>
</h2>
<p>Source routines are included in the <code><a href="reference/awardFindR.html">awardFindR()</a></code> function through the <em>sources</em> argument. Include the name of your new source (the section before "_standardize") in the default value of the <em>sources</em> for <code><a href="reference/awardFindR.html">awardFindR()</a></code> in <code>main.R</code>. This will include your new source routine in the default functionality, and expose the name in the documentation where users are likely to discover it.</p>
</div>
<div id="adding-tests" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-tests" class="anchor"></a>Adding Tests</h2>
<p>The main tests in <code>test-full.R</code> attempt to exercise both the successful and no results code branches. The latter always works. Unfortunately, the default search for the former (the terms “qualitative analysis” and “ethnography” in 2018) does not actually return results for some smaller sources. For this and other reasons, it’s a good idea to create a source-specific test for the <code>.*_standardize</code> function.</p>
<p>Tests should actually return results, but should also minimally tax the API. Less than 10 results would be ideal. There is one exception to this: when a source needs to loop through multiple pages. In this case, the smallest number of results that triggers the looping is ideal, in order to ensure maximum test coverage.</p>
<p>One test should verify reproducibility; i.e. we get the same results again for a query in a specified date range. When used with a real-world HTTP resource, this should alert us if there is a change in how the resource is provided.</p>
<p>Finally, HTTP requests for tests should be cached using the ROpenSci package <a href="https://docs.ropensci.org/vcr/"><code>vcr</code></a>. Individual sources should have their own cassettes. This limits stress on the APIs from frequent testing of internal logic, especially by the continuous integration system. Failure to do this could potentially result in service-level bans if we’re not careful.</p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>

</div>



      <footer>
      <div class="copyright">
  <p>Developed by Michael McCall, Sloan Foundation.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


